<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="../../../_generator/doc.xslt" media="screen" ?>
<!--
  Copyright 2010-2017 BusinessCode GmbH, Germany

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<doc:Doc title="Login" xmlns:doc="http://www.businesscode.de/schema/bcdui/doc-1.1.0">

  <doc:Chapter title="Overview" type="overview">
    <doc:Body>
      This tutorial shows how to enable user authentication in our simple tutorial application. 
      
          
      <div>The following steps are necessary in general:
      <dl>
        <dt>1. Enable the security section in web.xml</dt>
        <dd>Uncomment the shiro components and add a user, password </dd>
        <dt>2. Create a simple login page</dt>
        <dd>Create a simple formular to enter user name and password.</dd>
        <dt>3. Logout</dt>
        <dd>Create a simple menu item to make a logout.</dd>
        
      </dl>
      Each step is described in the following subsections.
      </div>
    </doc:Body>
  </doc:Chapter>

  <doc:Chapter title="Step by step">
    <doc:SubChapter title="Enable the security section in web.xml">
      <doc:Body>
        The first step is to enable the security filter in the web.xml file. BCD-UI uses the Shiro framework for this. A very simple static configuration
        can be seen below. There is one user 'demo' enabled. The login is form-based and the form is in login.html, which is explained in the next section.    
        Please note that some resources are public, so that the login page can access the theme stylesheets.
      <pre><![CDATA[
<!-- Security filter, enable if needed -->
<filter>
  <filter-name>bcdui4.ShiroFilter</filter-name>
  <filter-class>org.apache.shiro.web.servlet.IniShiroFilter</filter-class>
  <init-param>
    <param-name>config</param-name>
    <param-value></doc:xml>
    <pre>
      [main]
      
        cacheManager = org.apache.shiro.cache.ehcache.EhCacheManager
        securityManager.cacheManager = $cacheManager
        shiro.loginUrl      = /login.html
        authc.successUrl    = /simpleReq/index.html
        logout.redirectUrl = /login.html
        # Users and their roles
        # format: username = password, role1, role2, ..., roleN
        [users]
        demo = demo
        
        # Rules and their permissions
        # format: roleName = permission1, permission2, ..., permissionN
        [roles]
      
        # URLs which require login, users not logged in will be sent to /login.html
        # format: /reports/budget/** = authc, perms["pages:budget"]
        [urls]
        /bcdui/theme/**       = anon
        /login.html           = authc
        /simpleReq/**         = authc
        /logout               = logout
        
    </param-value>
  </init-param>
</filter>
<filter-mapping>
  <filter-name>bcdui4.ShiroFilter</filter-name>
  <url-pattern>/*</url-pattern>
</filter-mapping>
        ]]></pre>
        <p>
        The configuration uses shiro filters for authentication (authc) and also to for ending the session (logout). In the url section the url /logout is
        mapped to the logout filter. 
        The filter setting above turns on the shiro filter. Shiro starts its own EHCache, and in order to stop this properly, the following listener needs to be
        activated in web.xml. 
        </p>
        <pre><![CDATA[
        !-- This listener must be present when EHCache is used, because EHCache registers
        a thread which keeps the application from shutting down
        EHcache is for example used by shiro, check your web.xml -->
        <listener>
          <listener-class>net.sf.ehcache.constructs.web.ShutdownListener</listener-class>
        </listener>
        ]]></pre>
      </doc:Body>
    </doc:SubChapter>
    <doc:SubChapter title="Enable the security section in web.xml">
      <doc:Body>
        The login.html page is kept in the webApp directory as configured in the shiro section above. The action is empty and the redirection is made by
        the shiro filter. 
         <pre> authc.successUrl    = /simpleReq/index.html</pre>
      <doc:xml>

      </doc:xml>
    </doc:Body>
    </doc:SubChapter>
    <doc:SubChapter title="Create a simple login page">
     <doc:Body>
     <pre><![CDATA[
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8"></meta>
    <title>BCD-UI Tutorial</title>
    <link rel="stylesheet" type="text/css" href="bcdui/theme/css/allStyles.css"></link>
  </head>
  <body>
    <div id="bcdContextMenuDiv" style="display: none"></div>
    <div id="bcdTooltipDiv"     style="display: none"></div>
    <div id="bcdModalBoxDiv"    style="display: none"></div>
    <div id="bcdMainContainer">
      <div id="bcdHeaderArea">
        <div id="bcdLogoImageArea"></div>
      </div>
      <div id="bcdMenuBarArea"></div>
      <div id="bcdSpacerArea"></div>
      <div class="bcdContentContainer">
        <div id="bcdSideBarContainer">
        </div>
        <div id="bcdBodyContainer">
          <div class="bcdCaption">Login</div>
            <div id="myData">
              <div id="standardLogin">
                <form name="loginform" action="" method="post" style="margin: 20px 0px 0px 20px;">
                  <table>
                    <tr>
                      <td>Username (demo):</td>
                      <td><input type="text" name="username" maxlength="30"/></td>
                    </tr>
                    <tr>
                      <td>Password (demo):</td>
                      <td><input type="password" name="password" maxlength="30"/></td>
                    </tr>
                    <tr>
                      <td colspan="2" align="right" style="padding-top:10px;">
                        <button name="Login">Login</button>
                      </td>
                    </tr>
                  </table>
                </form>
                <script type="text/javascript">document.forms['loginform'].username.focus();</script>
              </div>    
            </div>
        </div>
       </div>
      </div>
    <script  type="text/javascript">
    </script>
  </body>
</html>     
 ]]></pre>
    <p>
    The form action in the login page above is empty and the redirection is configured in the web.xml:
    <pre>
      [main]
        cacheManager = org.apache.shiro.cache.ehcache.EhCacheManager
        securityManager.cacheManager = $cacheManager
        shiro.loginUrl      = /login.html
        authc.successUrl    = /simpleReq/index.html
        ...
    </pre>
    These configuration tell the shiro system which the login page is and where to redirect in case of a successful login.
    </p>
    <p>
      This is the page we just created:
    </p>
    <img src="login.png"/>
    
    </doc:Body>
    </doc:SubChapter>
    <doc:SubChapter title="Logout">
      <p>The shiro filter we configured above offers a logout, when the url/logout is invoked. A simple logout can be added to the menu bar.</p>
      <code><div id="bcdMenuBarArea"><div class="bcdMenu"><ul class="bcdLevel1"><li><a href="../logout">Logout</a></li></ul></div></div></code>
    </doc:SubChapter>
  </doc:Chapter>
</doc:Doc>